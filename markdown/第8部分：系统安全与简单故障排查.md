### ä¸€ã€åŸºæœ¬å®‰å…¨ç†å¿µ
#### 1.1 æœ€å°æƒé™åŸåˆ™
+ **ä¸è¦ç”¨ root æ‰§è¡Œä¸€åˆ‡**ï¼›
+ ç”¨æˆ·åº”åªå…·å¤‡å®Œæˆä»»åŠ¡æ‰€éœ€çš„æœ€å°æƒé™ã€‚

#### 1.2 ä½¿ç”¨ sudo ç®¡ç†ææƒ
+ ä½¿ç”¨ `sudo` ä¸´æ—¶ææƒï¼›
+ æ—¥å¿—è®°å½•å‘½ä»¤ï¼Œä¾¿äºè¿½è¸ªã€‚

#### 1.3 é‡è¦å»ºè®®
+ **åŠæ—¶æ›´æ–°ç³»ç»Ÿ**ï¼›
+ **è®¾ç½®å¼ºå¯†ç **ï¼›
+ **é™åˆ¶ SSH ç™»å½•ç”¨æˆ·æˆ–ä½¿ç”¨å¯†é’¥**ï¼›
+ **é¿å…å¯¹å¤–æš´éœ²ä¸å¿…è¦çš„æœåŠ¡æˆ–ç«¯å£**ï¼›
+ **ä½¿ç”¨æ—¥å¿—ç›‘æ§ç³»ç»Ÿæ´»åŠ¨**ã€‚

### äºŒã€å¸¸ç”¨æ—¥å¿—æŸ¥çœ‹ä¸æ’é”™
#### 2.1 ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤åœ¨ `/var/log/`ï¼‰
| æ—¥å¿—æ–‡ä»¶ | è¯´æ˜ |
| --- | --- |
| `/var/log/syslog` | ç³»ç»Ÿçº§æ—¥å¿—ï¼ˆé»˜è®¤æ¨èï¼‰ |
| `/var/log/auth.log` | ç™»å½•/è®¤è¯æ—¥å¿—ï¼ˆå¦‚ sudo, sshï¼‰ |
| `/var/log/dpkg.log` | å®‰è£…/å¸è½½è½¯ä»¶è®°å½• |
| `/var/log/ufw.log` | é˜²ç«å¢™æ—¥å¿—ï¼ˆéœ€å¯ç”¨ï¼‰ |
| `/var/log/nginx/` | Web æœåŠ¡æ—¥å¿—ï¼ˆå¦‚ Nginxï¼‰ |


#### 2.2 æ—¥å¿—æŸ¥çœ‹å‘½ä»¤
```bash
less /var/log/syslog
tail -f /var/log/auth.log
grep sshd /var/log/auth.log
```

### ä¸‰ã€ç”¨æˆ·ç™»å½•å®‰å…¨ä¸é™åˆ¶
#### 3.1 æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·
```bash
who
w
last
```

#### 3.2 é™åˆ¶ root ç™»å½•ï¼ˆäº†è§£ï¼‰
åœ¨ `/etc/ssh/sshd_config` ä¸­æ·»åŠ æˆ–ä¿®æ”¹ï¼š

```plain
PermitRootLogin no
```

ç„¶åé‡å¯ SSH æœåŠ¡ï¼š

```bash
sudo systemctl restart ssh
```

### å››ã€é˜²ç«å¢™ ufwï¼ˆç®€æ˜“é˜²ç«å¢™ï¼‰
#### 4.1 å®‰è£…ä¸å¯ç”¨ ufw
```bash
sudo apt install ufw
sudo ufw enable
sudo ufw status
```

#### 4.2 å…è®¸/æ‹’ç»ç«¯å£
```bash
sudo ufw allow ssh
sudo ufw allow http
sudo ufw deny 23            # ç¦ç”¨ telnet
sudo ufw delete allow 80    # åˆ é™¤è§„åˆ™
```

### äº”ã€ç³»ç»Ÿæ›´æ–°ä¸ç»´æŠ¤
#### 5.1 å®‰è£…å®‰å…¨æ›´æ–°
```bash
sudo apt update
sudo apt upgrade
```

#### 5.2 è‡ªåŠ¨æ›´æ–°è®¾ç½®ï¼ˆäº†è§£ï¼‰
å¯ä»¥å®‰è£…è‡ªåŠ¨æ›´æ–°æœåŠ¡ï¼š

```bash
sudo apt install unattended-upgrades
```

å¹¶é…ç½® `/etc/apt/apt.conf.d/50unattended-upgrades` æ–‡ä»¶ã€‚

æ³¨æ„ï¼šæ­£å¼å¯¹å¤–æä¾›æœåŠ¡çš„ç³»ç»Ÿä¸è¦è‡ªåŠ¨æ›´æ–°ã€‚

### å…­ã€ç®€å•æ•…éšœæ’æŸ¥æ¡ˆä¾‹
#### 6.1 SSH æ— æ³•ç™»å½•
+ ç½‘ç»œä¸é€šï¼Ÿâ†’ `ping æœåŠ¡å™¨IP`
+ ç«¯å£è¢«é˜²ç«å¢™æ‹¦æˆªï¼Ÿâ†’ `ufw status`
+ SSH æœåŠ¡æ˜¯å¦è¿è¡Œï¼Ÿâ†’ `systemctl status ssh`
+ æŸ¥çœ‹æ—¥å¿—ï¼š`tail /var/log/auth.log`

#### 6.2 ç½‘ç«™æ— æ³•è®¿é—®
+ Nginx æ˜¯å¦è¿è¡Œï¼Ÿâ†’ `systemctl status nginx`
+ ç«¯å£æ˜¯å¦ç›‘å¬ï¼Ÿâ†’ `ss -tuln | grep 80`
+ æŸ¥çœ‹æ—¥å¿—ï¼š`less /var/log/nginx/error.log`

#### 6.3 è½¯ä»¶æ— æ³•å®‰è£…
+ ç½‘ç»œè¿é€šæ€§ï¼›
+ æºåœ°å€æ˜¯å¦å¯è¾¾ï¼›
+ é”æ–‡ä»¶å ç”¨ï¼š

```bash
sudo rm /var/lib/dpkg/lock*
sudo dpkg --configure -a
```

## æœ¬ç« ç»ƒä¹ ä»»åŠ¡
### âœ… ç»ƒä¹ 1ï¼šæŸ¥çœ‹ç³»ç»Ÿä¸å®‰å…¨æ—¥å¿—
```bash
sudo less /var/log/syslog
sudo tail -f /var/log/auth.log
```

### âœ… ç»ƒä¹ 2ï¼šé…ç½®å¹¶å¯ç”¨é˜²ç«å¢™
```bash
sudo apt install ufw
sudo ufw enable
sudo ufw allow ssh
sudo ufw allow http
sudo ufw status verbose
```

### âœ… ç»ƒä¹ 3ï¼šå®‰å…¨æ›´æ–°ç³»ç»Ÿ
```bash
sudo apt update
sudo apt upgrade
```

### âœ… ç»ƒä¹ 4ï¼šæ¨¡æ‹Ÿæ•…éšœæ’æŸ¥æµç¨‹
1. åœæ‰ SSH æœåŠ¡

```bash
sudo systemctl stop ssh
```

2. ä½¿ç”¨æœ¬æœº ssh ç™»å½•å¤±è´¥ï¼ŒæŸ¥çœ‹åŸå› 

```bash
ssh localhost
sudo systemctl status ssh
```

3. é‡å¯ SSH æœåŠ¡å¹¶é‡è¯•

```bash
sudo systemctl start ssh
```

### ğŸ“¦ è¯¾åæ‹“å±•ä»»åŠ¡
1. ç”¨ `last` æŸ¥çœ‹ç™»å½•å†å²ï¼›
2. æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨æ—¶é—´ï¼š

```bash
who -b
```

3. è®¾ç½®é˜²ç«å¢™é»˜è®¤ç­–ç•¥ï¼š

```bash
sudo ufw default deny incoming
sudo ufw default allow outgoing
```

